<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Directed Graph Visualization</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body { margin: 0; overflow: hidden; background-color: #0d1117; font-family: 'Segoe UI', sans-serif; }
        svg { display: block; width: 100vw; height: 100vh; }

        .links path {
            fill: none;
            stroke: #58a6ff;
            stroke-opacity: 0.4;
            stroke-width: 1.5px;
        }

        .nodes circle {
            stroke: #fff;
            stroke-width: 1.5px;
            cursor: grab;
            fill: #1f6feb;
        }

        .nodes text {
            font-size: 10px;
            fill: #c9d1d9;
            pointer-events: none;
            font-family: monospace;
            text-shadow: 0 1px 2px black;
        }

        /* Hover effects */
        .nodes circle:hover {
            fill: #ff7b72;
            stroke: #ff7b72;
        }
        
        /* The container for the info box */
        #info {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(13, 17, 23, 0.9);
            border: 1px solid #30363d;
            color: #c9d1d9;
            padding: 15px;
            border-radius: 6px;
            pointer-events: none;
        }
    </style>
</head>
<body>

<div id="info">
    <strong>Directed Graph</strong><br>
    Scroll to Zoom<br>
    Drag to rearrange
</div>

<div id="graph-container"></div>

<script>
    const graphData = `btm: fft ydu amb
iyz: oez mpa ifc fav
hmy: itl rng
zwp: pll has jfp
ind: nqk icv gen
gak: och snq
rxb: you cef
kbx: rqk dik
qdi: imo sfq
liz: uii you cef
ssu: swr
ujd: usl uee tza bhg
idg: rjf apw
hut: dir lod eeh scm wyk
nui: mzz lhc wvw
edv: pzv jlq mdq pxm
ayl: vyt kuw
ude: haf ydu fft amb
qef: awx hrb imo sfq
dma: you cef
ash: phx kcm nli wdh
wvw: ufd rru hnx
wat: gwc mma
tnh: zwy
gco: qkw nen sby zew
ufd: pxm jlq mdq jfm
qdt: mlm
ypo: ftn kxm
xot: ucd bdl vus wxg
bfc: jet
oez: fyf zwu
cni: vpe ivo isz rch
qzx: ude
hzs: wan frm kbx vvk
nog: kbc jjh lat
tax: you
amg: xkz udl fth gir
vmj: out
ccp: szt tha uxg mxb
cau: rar uvi gwm
exu: dbn gun qyu qdn
dac: rar gwm
icv: prm ldj
vgq: spv
sdp: cdp sqt
mem: chy
fna: mco xde
ucf: out
hrb: aes tkj mem nnu dxt zxc ney vgq fch oex lam rnt sff ueb njz
has: dwq sav
inb: bum awx
pan: xmf rxf
nsr: lsx pal apa dhi rvh ybs hzs vww kxn moo bcy avy bps mzs nui dve dej xfh nfz xfy chr mha vey qap con
tzl: prr fky
ujg: jfm mdq
eht: ccp
vkd: vuw knl fls
och: nme obl sfr
vbr: qol qef
xao: ofv vxm
svh: mdq jfm pzv
gen: gjj
wyk: uei
tvy: aoc ogj
tiq: fjj yjo kch
uvi: cef
yjb: jlq
zfq: mpl
zzf: crk
xde: wdh kcm phx
qsk: mqj inb qis
fth: mlm yng tfq
rng: tax nug kyp
syf: bzr amg
kul: xng wvh
fav: gfx zwu
dwq: rhy msd
uii: pbf cqv rvf tvy mgb zzf zoz tiq iue ssu sxc vvc xpk zvd jeh
itl: jff nug bis kyp
hkd: anb jys
uhr: kpg
pal: kyh hut fml
uwj: caa gal
kex: pxm pzv mdq
end: yng mlm
eaa: zvq jgh joi
oop: ftn ojl jky
ypw: prg dnr dnu
pxm: fba oqs ihi xmn owr
mgb: zwp gmz yxg
fye: myb
chy: hkd sdm use rgo
anb: yng tfq
fqy: qpd wfe
lyg: msl qsb
wfe: dkf
zoz: aoc wat swr
lto: bhl gvg end xlm
kuw: xkz fth udl
seu: esu cgu
lod: vre uei lbc
bhg: fgu
sls: sfr
gal: imo awx bum
dxt: tnp ind
ueb: axq etb fqf
rqu: eha
qjb: mlm
ojl: hlp atg
oex: spv
pwu: mdq jfm
vey: wmh
wof: grn jet ddj qjb
ghm: onw mra cpy srh
nqk: lto ldj gjj
qis: sfq bum awx
fdu: joi
rut: vmg dwq sav
vzw: prg dnu
yyf: uel rxf
jfp: dwq vmg
xkz: mlm yng
ufq: ard esu cgu dqm
kbd: qol
ibf: pim iyz
gvg: mlm
mka: ivo vpe ghe rch isz
fyw: dws
gfv: etb zdv lir fqf
wug: amg vyt
mgg: rng
dsa: ypw vzw sge
sge: dyj prg
oyf: lhe oep rkv
amj: xde mco rhw
hao: ooe cha
ofv: pxm jfm mdq jlq
mdt: vzl wvh
fxt: oep
gwm: uii cef you
nyt: ucd bdl vus
kbc: dac
zxc: xyr syf
bsm: ujb kul mdt
etb: sud
mpg: eht
jff: cef
qsb: oep
nve: awx sfq hrb imo
sav: msd zfq rhy
xle: gcz ffw odd
vjx: jdy
wga: mdq jlq jfm
hlp: you
tlc: scm eeh wyk lod dir
cma: ypw sge
vxm: jfm mdq pzv pxm
moo: wan kbx vvk
fzz: out
dej: vvk
ipl: cef you
lby: tfq yng mlm
zye: rjf eth
gci: jjh
zvd: yjo qtq fjj kch
ard: ahq lyg xwl
mqj: imo sfq
vpe: wuh
rar: uii cef you
xpk: yxg zwp
xng: ucf
szt: out
obk: zwp gmz pno
snq: obl
kch: cux lxj
mxb: out
ouy: lat
njk: sgx qma iqs
atg: uii cef you
ihi: eha
qdn: out
pbf: nov cni
bis: uii
gmw: oep
ith: wga svh vxm ofv
odd: rky yqq vmj rlq
you: bdj jeh uuu tvy ssu ucu cqv
ypr: xng wvh
khr: ard
con: vvk frm wan
sxc: qtq fjj yjo
ssj: khr seu
dik: jlq mdq pzv
xmf: qss pbn bvz oyf
esu: lyg
zoo: rxf xmf
gir: tfq mlm
mzz: hnx
cdp: pih
mma: xbv
dir: vre lbc
lam: etm ezt kcx
zbb: rrh fdu eaa
mdq: xmn owr auq yqw rxy ndp fzm ghm
vvc: nov yew
wdh: awx hrb sfq
uei: mdq jlq
nov: isz rch ghe ivo
bch: jvb szo
axh: out
cdg: uxg mxb szt mah
prg: dma
grn: yng
ahq: zha qsb enj fxt
fky: out
dgk: rxw rmu gmw
yqq: out
ksj: zew sby qkw
msd: axh
ydu: atk xml
sqt: bdl wxg vus pih ucd
kpg: sdm use
rqk: mdq pzv pxm
rgi: qis ooe cha
wvh: prr
pzh: btm
jgh: oep lhe
iua: oop rya
gwq: cef
krl: zvq jgh
xfh: nof hut fml
ujb: tzl vzl xng
mnr: sgx qma iqs gak
joi: lhe rkv
ifc: gfx fyf zwu
mlr: onw srh
sfr: hrb bum awx
pix: itl rng zll
ooe: imo sfq
pnv: mha qap con bcy vey dve hzs vww dej nfz xfh pal mzs apa rvh nui ybs avy bps lsx
wkh: bdl ucd
lhe: lfq ict ywm ekl hmy ujd mgg aum wbz ouy avc nfj cma
wkl: fls szi vuw knl
qag: mso
yew: ivo vpe isz rch ghe
vyt: gir ebz udl
dyj: dma kat vdm
ybl: cdp sqt nyt
qma: snq sls xre och
mco: kcm
fgu: yju liz zwy rxb
jys: yng
pfv: khr ufq
rrh: joi
uvu: vuw szi fls
voo: pxm pzv jlq mdq
ezt: rgo
pih: svv lby
fft: vbr kbd atk
vuw: fkz pwu api qbq
nnu: chy ezt kcx
nli: awx
fls: qbq api
etm: sdm rgo hkd
lhi: yng mlm
vzl: fky ucf
mso: dbn gun
gun: out
pno: rut jkg pll jfp
eaz: mqj ooe cha qis
ymy: ufq seu
kcx: hkd
rhu: fyf
dhi: xao ith
zvq: oep lhe
api: pxm
qbq: pzv
hhh: poi
ebz: yng
xjk: kxn nfz dej dve vey con mha moo chr xfy lsx bps ybs dhi pal
vdm: you
rya: ftn jky
apa: vkd wkl uvu wmh
ilk: pxm jfm
ppx: ypr
ftn: gwq rqj owq hlp
swr: mma xcf
dnr: kat vdm
jet: tfq
scm: lbc
mzs: tlc
pnc: ufq khr
prr: out
yju: uii
jib: uwj eha
fiy: nui rvh ybs apa dhi lsx bps mha moo vey bcy qap con xfy chr xfh kxn nfz hzs vww ikw
zhv: mlm yng
pjl: xav
obl: sfq imo hrb awx bum
xmn: onw cpy mra srh
rjf: dyb oyi loo xii
chr: wvw lhc ipc
use: muf anb
bum: njz gfv ipn cel rnt ueb jpe zco mem aes uhr zxc poo
dyb: voo yjb ilk
pbn: oep
pzv: jib fzm fba guf ghm hfb dzb vjx thc qzx mlr rxy yqw ihi
rnt: xyr wyg
spv: nyt wkh cdp sqt
uuu: gjv
ftt: ryz qig
wbz: bhg uee glm
qkw: zbb lcj
aes: rde tnp
qig: hgl dgk fye
cha: hrb bum
apw: oyi ajz loo xii
eze: rhw
rhy: axh mpl
eta: nme
ikw: idg zru
kxn: xgh
caa: awx sfq hrb
xgh: wga ofv
cel: axq fqf
ybs: lhc wvw mzz
cgu: ahq
vww: suv wkl uvu wmh
qyr: uvi rar
ucu: hra gjv
gjv: ppx
amb: kbd vbr xml
suv: fls szi vuw
auq: amj
eeh: lbc vre uei
vmg: mqt msd
bkm: icc iyz tro
ywm: vzw ypw
dqm: ahq
gno: rij
ujp: lto
frm: rqk ujg
rxy: jfz
kat: uii cef
uee: tnh
kcm: bum sfq
imo: rnt ueb jpe gfv gah njz ipn aes uhr mem tkj zxc poo dxt nnu ney zco fch yyq oex
jeh: qtq fjj
gwc: qag sha
sha: exu mso
ipc: rru hnx ufd
jjh: cau dac qyr
mqt: mpl fzz
zha: oep rkv
tzi: zvq
gjj: end bhl gvg xlm
mah: out
bzr: udl ebz fth
wan: ujg edv
pll: vmg
lat: paf dac qyr
dzb: eze fna jkf svb
tyx: ryz
rhw: egw kcm nli
iqs: eta sls och
mpl: out
jfm: hfb ghm guf fba jib fzm vjx pzh dzb gno auq qzx thc rqu oqs ndp rxy mlr xmn ihi
lir: sud fyw
hnl: yng
qyu: out
obq: loo ajz dyb oyi xii
tkj: tvq bfc kgh
zdv: fyw sud
awx: nnu zxc ueb vgq rnt gfv fch
xlm: tfq mlm yng
nrt: qig
wqc: qdn dbn gun
kyh: lod dir scm eeh
atk: qdi
jky: rqj hlp
cqv: yew nov mka cni
fyf: rkv
mpa: gfx
rru: jlq jfm pzv
nfj: rbx oop ypo
prm: gvg bhl gaj
xbv: mso wqc
dbn: out
aum: bhg glm
paf: rar
kai: grn ddj
ysg: xmf rxf
fba: jdy uwj eha
msl: lhe rkv
dnu: vdm dma kat
yjo: mpg lxj qbz
icc: rhu mpa ifc
thc: svb
ict: tza
yvs: nen sby
sjf: yew nov
jkf: ash xde rhw
gah: spv iac ybl sdp
xfy: frm wan
dkf: mxb uxg tha mah
nfz: iiv zye
mra: ele rgi qsk eaz
yep: bch
zwu: lhe
rgo: muf jys
rij: iqs gak sgx qma
xhp: szo jvb
njz: ybl sdp spv
cpy: rgi qsk
oyi: ilk
rvh: xao ith xgh
hnx: pxm jlq mdq jfm
ivo: wuh
sgx: och
dve: tlc nof kyh fml
jvb: mlm yng tfq
zru: ngm
fch: bfc tvq kgh kai
zxj: gak sgx qma
lxj: wfe eht
qap: xao ith xgh
nug: uii you cef
svr: xjk nsr tfw fiy pnv
xav: rmu
gcz: rky vmj bwb
pim: oez
ryz: xav hgl fye
rqj: uii
tvq: lhi
rde: gen
ucd: ywl lby svv
rkv: pix hfg gci avc ywm syz dsa nog hmy
zll: kyp bis nug tax jff
lhc: ufd jbh hnx rru
knl: hqj pwu fkz
svv: yng
yxg: jfp rut jkg
wxg: lby svv zhv
bcy: uvu vkd
bwb: out
nme: imo hrb bum
tro: mpa oez fav rhu
poo: xyr
rvf: gjv
owq: cef uii
iue: gjv crk hra
jkg: sav dwq
xii: kex
ipn: syf wug ayl
jhb: exu
hfb: mnr njk rij
wyg: bzr kuw amg
svb: ash mco
qol: sfq imo hrb awx bum
zco: ybl iac
zwy: cef
bdl: svv ywl
tfq: zoo bkm ksj ymy pfv tyx ibf gco tbz nrt ftt ysg pan pnc cif yyf ssj yvs
yng: pan pnc ftt yvs yyf ssj cif ymy ksj bkm zoo mro gco tbz tyx pfv ibf
isz: xle
usl: fgu cdt
srh: hao ele qsk rgi
xml: qol qef
phx: bum hrb
tbz: tro icc
jdy: gal
iac: xot
tnp: nqk ujp
lfq: rbx
sby: lcj zbb
ney: rde ind
jlq: guf jib qzx hfb dzb gno
vvk: ujg rqk dik edv
vre: pzv jlq mdq jfm pxm
eha: nve hhb
cif: uel
zew: vqs lcj
lcj: rrh tzi eaa krl
qss: rkv
enj: lhe rkv
hra: ppx rmm
haf: kbd atk
rmm: ypr mdt kul
muf: tfq yng
ffw: bwb rlq yqq
oqs: fna
wuh: ffw spg wxz odd
hfg: zll
ele: inb ooe
lbc: pxm jlq mdq jfm pzv
jfz: haf
mlm: ysg zoo nrt pnc ymy bkm ibf mro gco yyf
gmz: jfp
szo: tfq
ngm: dyb oyi
avy: zru zye
crk: bsm ppx
ndp: btm ude
gaj: mlm yng
fqf: sud
ghe: gti xle
rmu: rkv lhe
cdt: liz ipl
gfx: lhe oep
xyr: vyt
yqw: zxj
sud: dws xhp
poi: qyr dac
fml: dir
rlq: out
hhb: awx imo hrb sfq
yyq: kcx
egw: sfq hrb imo bum
kyp: uii cef
nof: lod eeh scm wyk
bps: idg zru iiv
wxz: rlq bwb yqq rky
vus: ywl zhv lby
jpe: kgh
qbz: qpd wfe
lsx: xao
gti: spg odd
rbx: ojl
rxw: rkv lhe
mha: mzz
ajz: ypa yjb ilk
ddj: yng mlm tfq
udl: mlm
fzm: jfz ude
ypa: mdq
bvz: oep lhe
rch: wuh gti
iiv: obq eth
szi: fkz api qbq
bdj: zwp yxg gmz pno
ogj: mma gwc vdb
rky: out
bhl: yng tfq
axq: sud yep
myb: lhe
tfw: nui dhi apa pal mzs avy qap bcy vey mha xfy nfz kxn hzs
qpd: ccp cdg
uxg: out
kgh: grn ddj qjb lhi
vdb: xbv sha jhb qag
owr: svb jkf amj fna eze
vqs: eaa fdu tzi rrh
nen: hpe zbb vqs
hgl: rmu gmw
guf: mnr rij
sdm: muf qdt anb
onw: ele hao rgi qsk eaz
ywl: tfq
ekl: itl rng
aoc: gwc vdb
hqj: jfm jlq pxm
eth: xii oyi loo ajz
qtq: cux fqy
fkz: pxm jfm jlq mdq
fjj: mpg cux qbz fqy lxj
spg: vmj rlq
sff: wof kgh tvq bfc
rxf: pbn qss bvz
tza: cdt fgu
jbh: mdq
mro: pjl qig
avc: usl uee tza bhg
hpe: krl fdu eaa
xwl: qsb zha enj msl fxt
cef: jeh uuu vvc sxc bdj tiq sjf iue zzf zoz mgb pbf obk
ldj: bhl end xlm gaj
sfq: tkj nnu poo gah gfv njz yyq ipn
xcf: sha
loo: yjb ypa kex voo
oep: ekl ict ywm dsa mgg iua wbz hhh gci nfj
cux: wfe qpd
dws: hnl szo jvb
wmh: knl fls szi
glm: tnh cdt
syz: lat jjh
uel: qss pbn bvz
xre: nme
tha: out
kxm: hlp owq gwq`;

    // 1. DATA PARSING (Directed)
    const nodes = new Map();
    const links = [];

    // Helper to ensure node existence
    function getNode(id) {
        if (!nodes.has(id)) {
            nodes.set(id, { id: id, incoming: 0, outgoing: 0 });
        }
        return nodes.get(id);
    }

    // Parse logic
    const lines = graphData.trim().split('\n');
    lines.forEach(line => {
        const [sourceId, targetStr] = line.split(': ');
        if(targetStr) {
            const targets = targetStr.split(' ');
            targets.forEach(targetId => {
                if(sourceId !== targetId) { // Skip self-loops
                    // Create object references for D3
                    const src = getNode(sourceId);
                    const tgt = getNode(targetId);
                    
                    src.outgoing++;
                    tgt.incoming++;

                    links.push({ source: sourceId, target: targetId });
                }
            });
        }
    });

    const graph = {
        nodes: Array.from(nodes.values()),
        links: links
    };

    // 2. VISUALIZATION SETUP
    const width = window.innerWidth;
    const height = window.innerHeight;
    const nodeRadius = 6; // Fixed radius to make arrow positioning easy

    const svg = d3.select("#graph-container").append("svg")
        .attr("width", width)
        .attr("height", height)
        .call(d3.zoom().on("zoom", (event) => g.attr("transform", event.transform)))
        .on("dblclick.zoom", null);

    // DEFINE ARROWHEADS
    // We define a marker that sits slightly back from the node radius
    const defs = svg.append("defs");
    defs.append("marker")
        .attr("id", "arrow")
        .attr("viewBox", "0 -5 10 10")
        .attr("refX", 18) // Distance from center of node (Radius 6 + Buffer)
        .attr("refY", 0)
        .attr("markerWidth", 6)
        .attr("markerHeight", 6)
        .attr("orient", "auto")
        .append("path")
        .attr("d", "M0,-5L10,0L0,5")
        .attr("fill", "#58a6ff")
        .attr("fill-opacity", 0.6);

    const g = svg.append("g");

    const simulation = d3.forceSimulation(graph.nodes)
        .force("link", d3.forceLink(graph.links).id(d => d.id).distance(60))
        .force("charge", d3.forceManyBody().strength(-150))
        .force("center", d3.forceCenter(width / 2, height / 2))
        .force("collide", d3.forceCollide(nodeRadius + 2));

    // Links (Paths instead of Lines to allow curving)
    const link = g.append("g")
        .attr("class", "links")
        .selectAll("path")
        .data(graph.links)
        .join("path")
        .attr("marker-end", "url(#arrow)");

    // Nodes
    const node = g.append("g")
        .attr("class", "nodes")
        .selectAll("circle")
        .data(graph.nodes)
        .join("circle")
        .attr("r", nodeRadius)
        .call(drag(simulation));

    // Labels (only show on hover or for important nodes to reduce clutter)
    const label = g.append("g")
        .selectAll("text")
        .data(graph.nodes)
        .join("text")
        .text(d => d.id)
        .attr("x", 8)
        .attr("y", 3);

    // 3. TICK FUNCTION
    // We use a custom path generator to curve lines if there are bidirectional links
    simulation.on("tick", () => {
        link.attr("d", (d) => {
            const dx = d.target.x - d.source.x;
            const dy = d.target.y - d.source.y;
            const dr = Math.sqrt(dx * dx + dy * dy);
            
            // Just a straight line, but defined as a path
            // For a truly directed graph with A->B and B->A, we would usually curve them.
            // D3 force layout handles 'multiple' links by curving them if you process them,
            // but for simple adjacency, straight lines are cleaner unless overlap is detected.
            // Here we stick to straight lines for performance and clarity on this dataset size.
            return `M${d.source.x},${d.source.y}L${d.target.x},${d.target.y}`;
        });

        node
            .attr("cx", d => d.x)
            .attr("cy", d => d.y);

        label
            .attr("x", d => d.x + 10)
            .attr("y", d => d.y + 4);
    });

    // 4. DRAG LOGIC
    function drag(simulation) {
        function dragstarted(event, d) {
            if (!event.active) simulation.alphaTarget(0.3).restart();
            d.fx = d.x;
            d.fy = d.y;
        }

        function dragged(event, d) {
            d.fx = event.x;
            d.fy = event.y;
        }

        function dragended(event, d) {
            if (!event.active) simulation.alphaTarget(0);
            d.fx = null;
            d.fy = null;
        }

        return d3.drag()
            .on("start", dragstarted)
            .on("drag", dragged)
            .on("end", dragended);
    }
    
    // Auto-Label visibility
    svg.on("zoom", (e) => {
        g.attr("transform", e.transform);
        // Show labels if zoomed in
        label.style("display", e.transform.k > 1.2 ? "block" : "none");
    });
    label.style("display", "none"); // init hidden

</script>
</body>
</html>